# Mypy configuration
# WHY: Static type checker for Python - catches type errors before runtime
# HOW: Place in project root, run with: mypy agents/ infrastructure/

[mypy]
# Python version to target
python_version = 3.12

# Strictness settings
# Start with strict mode, relax as needed
strict = True

# Import discovery
namespace_packages = True
explicit_package_bases = True

# Disallow dynamic typing
disallow_any_unimported = False
disallow_any_expr = False
disallow_any_decorated = False
disallow_any_explicit = False
disallow_any_generics = True
disallow_subclassing_any = True

# Disallow untyped definitions
disallow_untyped_calls = True
disallow_untyped_defs = True
disallow_incomplete_defs = True
check_untyped_defs = True
disallow_untyped_decorators = False

# None and Optional handling
no_implicit_optional = True
strict_optional = True

# Warnings
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_return_any = False
warn_unreachable = True

# Error messages
show_error_context = True
show_column_numbers = True
show_error_codes = True
pretty = True
color_output = True

# Miscellaneous
warn_unused_configs = True
strict_equality = True
strict_concatenate = True

# Per-module options
# Use this to gradually adopt strict typing

[mypy-tests.*]
# Tests can be less strict
disallow_untyped_defs = False
disallow_untyped_calls = False

[mypy-anthropic.*]
# Third-party libraries without stubs
ignore_missing_imports = True

[mypy-redis.*]
ignore_missing_imports = True

[mypy-fastapi.*]
ignore_missing_imports = True

[mypy-pydantic.*]
ignore_missing_imports = True

[mypy-pytest.*]
ignore_missing_imports = True

[mypy-langchain.*]
ignore_missing_imports = True

[mypy-langgraph.*]
ignore_missing_imports = True

# RUNNING MYPY
# ============
#
# Check all code:
#   mypy .
#
# Check specific directory:
#   mypy agents/
#
# Check specific file:
#   mypy agents/cmo_agent.py
#
# Generate HTML report:
#   mypy --html-report mypy_report agents/
#
# Show error statistics:
#   mypy --show-error-codes agents/
#
# FIXING TYPE ERRORS
# ==================
#
# Common patterns:
#
# 1. Add type hints:
#    def process(data):  # ❌
#    def process(data: Dict[str, Any]) -> List[str]:  # ✅
#
# 2. Use Optional for nullable values:
#    def get_user(id: int) -> User | None:  # ✅
#
# 3. Use TypeVar for generics:
#    T = TypeVar('T')
#    def first(items: List[T]) -> T | None:  # ✅
#
# 4. Use Protocol for duck typing:
#    class Runnable(Protocol):
#        def run(self) -> None: ...
#
# 5. Use cast() when you know better than mypy:
#    from typing import cast
#    value = cast(str, potentially_str_value)
